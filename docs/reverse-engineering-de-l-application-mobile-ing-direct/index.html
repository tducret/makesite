<!DOCTYPE html>
<link rel="icon" href="data:;base64,=">
<meta charset="utf-8">
<title>Reverse engineering de l'application mobile ING Direct - tducret.com</title>
<style>html { background-color: #f4f3ec; }
    header {text-align: center;}
    body {
        background-color: #ffffff;
        margin: auto;
        max-width: 700px;
        padding: 5px 50px;
        font-family: Georgia, 'Times New Roman', Times, serif;
        color: #444;
    }
    nav {padding-bottom: 30px}
    nav a {text-decoration: none; font-weight: bold ; color:#8b0000}
    h1.logo {
        font-family: monospace, 'Courier New', Courier;
        font-size: 40px;
    }
    h1, h2, h3 {
        font-family: Helvetica, Arial, sans-serif;
        color: #000
    }
    h3 {
        font-size: 22px;
        padding-top: 30px;
    }
    h2 {
        color: #000;
        padding-top: 10px;
    }
    p {line-height: 1.42;}
    p a {color: #444}
    h3 a {
        text-decoration: none;
        color: #000;
    }
    footer {padding-top: 50px;}
    pre code {
        background: #f4f4f4;
        border: 1px solid #ddd;
        border-left: 3px solid #f36d33;
        color: #666;
        page-break-inside: avoid;
        font-family: monospace, 'Courier New', Courier;
        line-height: 1.6;
        margin-bottom: 1.6em;
        max-width: 100%;
        overflow: auto;
        padding: 1em 1.5em;
        display: block;
        word-wrap: break-word;
    }
    code {
        font-size: 15px;
        border: 1px solid #e8e8e8;
        border-radius: 3px;
        background-color: #f4f4f4;
        padding: 1px 5px;
    }
    blockquote {
        font-style: italic;
        border-left: 3px solid #57ad68;
        margin-left: 0;
        padding-left: 25px;}
    hr {
        width: 15%;
        margin: 30px auto;
        border: none;
        height: 1px;
        background-color: #ddd;
    }
    .wider {
        width: 80%;
        margin-top: 5px;
    }
    img {
        max-width: 100%;
        margin: 0 auto;
        margin-top: 43px;
        display: block;
    }
</style>
<header>
    <h1 class="logo">[td]</h1>
    <nav><a href="/makesite/">Accueil</a> | <a href="https://github.com/tducret" target="_blank">Github</a> | <a href="https://www.linkedin.com/in/thibaultducret" target="_blank">Linkedin</a> | <a href="https://visualping.io/?url=tducret.com&mode=text" target="_blank" title="Soyez notifi√© des nouveaux articles">üîî</a></nav>
</header>
<hr class="wider">
<h1>Reverse engineering de l'application mobile ING Direct</h1>
<p>Depuis quelques ann√©es, je note r√©guli√®rement sur une feuille Excel le solde de chacun de mes comptes bancaires. Je ne r√©cup√®re pas tout l'historique des op√©rations, juste le montant disponible ce jour-l√†. Cela me permet de suivre l'√©volution de nos √©conomies.
Cette t√¢che peut prendre du temps car nous avons des comptes dans diff√©rentes banques (comptes courants, plan d'√©pargne entreprise, PEA...). Je le fais donc tous les 6 mois environ.</p>
<p>Il faut :</p>
<ul>
<li>se connecter sur le site d'une banque</li>
<li>se souvenir du login/mots de passe</li>
<li>les saisir dans une interface s√©curis√©e (mais surtout compliqu√©e)</li>
<li>noter le solde de chaque compte sur ma feuille Excel de suivi</li>
<li>passer √† la banque suivante</li>
</ul>
<p>Je n'affectionne pas vraiment les t√¢ches manuelles, en particulier si elles se r√©p√®tent dans le temps (vous le verrez dans les diff√©rents articles de ce blog)...</p>
<p><strong>Automatisons √ßa !</strong></p>
<p>L'objectif est donc de r√©cup√©rer le solde de mes comptes par un script, pour faciliter la mise √† jour de cette feuille Excel (voire de la mettre √† jour automatiquement).
Cela permettra aussi de le faire plus r√©guli√®rement.</p>
<p>Plusieurs services existent sur le web pour suivre l'√©tat de ses comptes, avec des notifications, des graphes... On peut penser √† <a href="https://www.linxo.com/">Linxo</a> notamment. Malheureusement, je me retrouve toujours avec quelques comptes qui ne peuvent √™tre synchronis√©s. La banque n'√©tant pas encore reconnue par Linxo (cf. <a href="https://www.linxo.com/decouvrir/liste-banques/">liste des banques reconnues</a>). L'envoi des codes de connexion de ses comptes bancaires √† des sites tiers peut √©galement √™tre un frein pour certains.</p>
<h1>Scraping : k√©zako?</h1>
<blockquote>
<p>Le scraping, c'est l'art de r√©cup√©rer des informations automatiquement sur des pages web. Par exemple, vous r√©alisez un script qui permet d'extraire la m√©t√©o dans votre ville, en r√©cup√©rant les infos dans le code HTML du site meteofrance.fr.</p>
</blockquote>
<p>Pour ce projet, je commence par la r√©cup√©ration des informations de mes comptes chez ING Direct. Pour cela, deux options s'offrent √† moi :</p>
<ol>
<li>le scraping via la page web HTML ingdirect.fr</li>
<li>reproduire les √©changes de l'application mobile ING Direct</li>
</ol>
<p>Je choisis la deuxi√®me option car l'utilisation des interfaces de programmation (API) des applications mobiles est plus performant que l'extraction d'informations dans des pages HTML. Le volume de donn√©es √©chang√©es est en effet beaucoup plus faible que celui contenu dans une page HTML.
Cependant, certaines de ces API ne sont pas document√©es. C'est le cas ici pour ING. Il faut alors faire de la <a href="https://fr.wikipedia.org/wiki/R%C3%A9tro-ing%C3%A9nierie">r√©tro-ing√©nierie</a> (ou reverse engineering) pour d√©couvrir leur fonctionnement. √áa tombe bien, c'est un exercice qui me passionne!</p>
<h1>Charles : l'outil ultime pour savoir ce que raconte votre mobile</h1>
<p>Pour connaitre l'API de consultation des comptes d'ING Direct, je dois visualiser les √©changes entre mon smartphone et les serveurs d'ING. Il existe un outil parfait pour cette t√¢che : <a href="https://www.charlesproxy.com/">Charles</a>. Il est disponible sur Windows/Mac/Linux, avec une version d'essai gratuite parfaitement fonctionnelle.</p>
<p>Charles permet de cr√©er un proxy sur votre PC, sur lequel votre smartphone va se connecter pour acc√©der √† internet. Ainsi, tout ce qu'il √©changera avec le web sera visualisable sur le PC.</p>
<p>Voici les √©tapes d√©roul√©es pour d√©couvrir l'API non officielle d'ING Direct :</p>
<ol>
<li>Configuration du proxy sur mon smartphone : je mets l'IP de mon PC dans le proxy du WiFi (plus d'infos <a href="https://www.charlesproxy.com/documentation/configuration/browser-and-system-configuration/">ici</a>)</li>
<li>Lancement de Charles sur mon PC en mode proxy</li>
<li>Installation du certificat SSL de Charles sur mon smartphone, pour pouvoir visualiser dans Charles les requ√™tes HTTPS (plus d'infos <a href="https://www.charlesproxy.com/documentation/using-charles/ssl-certificates/">ici</a>)</li>
<li>Utilisation de l'application ING sur mon smartphone : login, consultation des comptes, d√©connexion</li>
<li>R√©cup√©ration des requ√™tes et r√©ponses dans Charles</li>
<li>Compr√©hension de la logique des √©changes en observant les requ√™tes et leurs param√®tres</li>
</ol>
<h2>Mod√©lisation des √©changes Mobile ‚ü∑ ING Direct</h2>
<p>Voici le diagramme de s√©quences qui illustre la succession des √©changes entre mon mobile et les serveurs ING Direct lors de la consultation de mes comptes.</p>
<p><img src="../images/20180524/diag.png" alt="Diagramme de s√©quences mobile/ING" /></p>
<h1>Cr√©ation d'un package Python et d'une commande</h1>
<p>A partir de ces d√©couvertes, je peux reproduire le comportement de l'application mobile avec du code Python. Je cr√©e alors un package d√©di√© (<strong>ingdirect</strong>, disponible sur <a href="https://pypi.org/project/ingdirect/">pip</a>), ainsi qu'une commande <code>ing</code> pour interroger tr√®s simplement ses comptes bancaires en ligne de commande.</p>
<p><em>Toutes les infos sur les param√®tres d'entr√©e et sortie et l'utilisation de la commande sont sur <a href="https://github.com/tducret/ingdirect-python">la page Github du package ingdirect-python</a>.</em></p>
<p>A titre indicatif, voici l'aide de la commande <code>ing</code> :</p>
<pre><code>Usage: ing [OPTIONS]

  R√©cup√®re la synth√®se des comptes bancaires ING Direct

Options:
  -n, --numero-client TEXT   votre num√©ro client ING Direct
  -d, --date-naissance TEXT  votre date de naissance au format JJMMAAAA (ex:
                             30121982)
  -c, --code TEXT            votre mot de passe ING Direct (ex : 123456)
  --version                  Show the version and exit.
  --help                     Show this message and exit.
</code></pre>
<p>On peut alors obtenir ce type de r√©sultat, directement dans le terminal (en 3 petites secondes) :</p>
<pre><code>Nom du compte;Solde
Compte Courant XXXX 1234;1500,5‚Ç¨
Livret A XXXX 3456;10000,0‚Ç¨
</code></pre>
<p><strong>MISSION ACCOMPLIE!</strong></p>
<p>N'h√©sitez pas √† ajouter une √©toile au projet Github si cela vous a plu (<a href="https://github.com/tducret/ingdirect-python">‚òÖ ‚Üí ingdirect-python</a>)</p>

<footer></footer>
</html>